<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
<!--
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
-->

<!-- Put site-specific property overrides in this file. -->

<configuration>

  <!-- Metastore DB config using Environment Variables -->
  <property>
    <name>javax.jdo.option.ConnectionURL</name>
    <!-- Reads HIVE_METASTORE_DB from environment -->
    <value>jdbc:postgresql://postgres:5432/hive_metastore</value>
    <description>JDBC connect string for a JDBC metastore</description>
  </property>

  <property>
    <name>javax.jdo.option.ConnectionDriverName</name>
    <value>org.postgresql.Driver</value>
    <description>Driver class name for a JDBC metastore</description>
  </property>

  <property>
    <name>javax.jdo.option.ConnectionUserName</name>
    <!-- Reads POSTGRES_USER from environment -->
    <value>admin</value>
    <description>Username to use against metastore database</description>
  </property>

  <property>
    <name>javax.jdo.option.ConnectionPassword</name>
    <!-- Reads POSTGRES_PASSWORD from environment -->
    <value>admin123</value>
    <description>Password to use against metastore database</description>
  </property>

  <!-- Automatically create/update schema -->
   <property>
    <name>datanucleus.autoCreateSchema</name>
    <value>true</value>
  </property>
  <property>
    <name>datanucleus.fixedDatastore</name>
    <value>true</value>
  </property>

  <!-- Metastore URI (Service talks to itself) -->
  <property>
    <name>hive.metastore.uris</name>
    <value>thrift://hive-metastore:9083</value>
    <description>Thrift URI for the remote metastore. Used by metastore client to connect to remote metastore.</description>
  </property>

  <!-- Hive warehouse directory in MinIO -->
  <property>
    <name>hive.metastore.warehouse.dir</name>
    <!-- Adjust bucket name 'gold' if needed -->
    <value>s3a://gold/warehouse/</value> 
    <description>Location of default database for managed tables</description>
  </property>

    <!-- Define S3A FileSystem implementation -->
  <property>
    <name>fs.s3a.impl</name>
    <value>org.apache.hadoop.fs.s3a.S3AFileSystem</value>
  </property>


  <!-- S3A (MinIO) configuration using Environment Variables -->
  <property>
    <name>fs.s3a.endpoint</name>
    <value>http://minio:9000</value>
  </property>

  <property>
    <name>fs.s3a.access.key</name>
    <!-- Reads MINIO_ROOT_USER from environment -->
    <value>admin</value>
  </property>

  <property>
    <name>fs.s3a.secret.key</name>
    <!-- Reads MINIO_ROOT_PASSWORD from environment -->
    <value>admin123</value>
  </property>

  <property>
    <name>fs.s3a.path.style.access</name>
    <value>true</value>
  </property>
  
  <!-- Optional: Disable S3A Change Detection (can improve performance with MinIO) -->
  <property>
    <name>fs.s3a.change.detection.mode</name>
    <value>none</value>
  </property>
  <property>
    <name>fs.s3a.change.detection.version.required</name>
    <value>false</value>
  </property>

</configuration>
